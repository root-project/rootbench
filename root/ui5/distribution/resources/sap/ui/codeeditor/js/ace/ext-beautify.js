ace.define("ace/ext/beautify",[],function(r,e,m){"use strict";var T=r("../token_iterator").TokenIterator;function a(t,b){return t.type.lastIndexOf(b+".xml")>-1;}e.singletonTags=["area","base","br","col","command","embed","hr","html","img","input","keygen","link","meta","param","source","track","wbr"];e.blockTags=["article","aside","blockquote","body","div","dl","fieldset","footer","form","head","header","html","nav","ol","p","script","section","style","table","tbody","tfoot","thead","ul"];e.beautify=function(s){var b=new T(s,0,0);var t=b.getCurrentToken();var c=s.getTabString();var d=e.singletonTags;var f=e.blockTags;var n;var g=false;var h=false;var j=false;var k="";var v="";var l="";var o=0;var p=0;var q=0;var u=0;var w=0;var x=0;var y=0;var z;var A=0;var B=0;var C=[];var D=false;var i;var E=false;var F=false;var G=false;var H=false;var I={0:0};var J=[];var K=false;var L=function(){if(n&&n.value&&n.type!=='string.regexp')n.value=n.value.replace(/^\s*/,"");};var M=function(){k=k.replace(/ +$/,"");};var N=function(){k=k.trimRight();g=false;};while(t!==null){A=b.getCurrentTokenRow();C=b.$rowTokens;n=b.stepForward();if(typeof t!=="undefined"){v=t.value;w=0;G=(l==="style"||s.$modeId==="ace/mode/css");if(a(t,"tag-open")){F=true;if(n)H=(f.indexOf(n.value)!==-1);if(v==="</"){if(H&&!g&&B<1)B++;if(G)B=1;w=1;H=false;}}else if(a(t,"tag-close")){F=false;}else if(a(t,"comment.start")){H=true;}else if(a(t,"comment.end")){H=false;}if(!F&&!B&&t.type==="paren.rparen"&&t.value.substr(0,1)==="}"){B++;}if(A!==z){B=A;if(z)B-=z;}if(B){N();for(;B>0;B--)k+="\n";g=true;if(!a(t,"comment")&&!t.type.match(/^(comment|string)$/))v=v.trimLeft();}if(v){if(t.type==="keyword"&&v.match(/^(if|else|elseif|for|foreach|while|switch)$/)){J[o]=v;L();j=true;if(v.match(/^(else|elseif)$/)){if(k.match(/\}[\s]*$/)){N();h=true;}}}else if(t.type==="paren.lparen"){L();if(v.substr(-1)==="{"){j=true;E=false;if(!F)B=1;}if(v.substr(0,1)==="{"){h=true;if(k.substr(-1)!=='['&&k.trimRight().substr(-1)==='['){N();h=false;}else if(k.trimRight().substr(-1)===')'){N();}else{M();}}}else if(t.type==="paren.rparen"){w=1;if(v.substr(0,1)==="}"){if(J[o-1]==='case')w++;if(k.trimRight().substr(-1)==='{'){N();}else{h=true;if(G)B+=2;}}if(v.substr(0,1)==="]"){if(k.substr(-1)!=='}'&&k.trimRight().substr(-1)==='}'){h=false;u++;N();}}if(v.substr(0,1)===")"){if(k.substr(-1)!=='('&&k.trimRight().substr(-1)==='('){h=false;u++;N();}}M();}else if((t.type==="keyword.operator"||t.type==="keyword")&&v.match(/^(=|==|===|!=|!==|&&|\|\||and|or|xor|\+=|.=|>|>=|<|<=|=>)$/)){N();L();h=true;j=true;}else if(t.type==="punctuation.operator"&&v===';'){N();L();j=true;if(G)B++;}else if(t.type==="punctuation.operator"&&v.match(/^(:|,)$/)){N();L();if(v.match(/^(,)$/)&&y>0&&x===0){B++;}else{j=true;g=false;}}else if(t.type==="support.php_tag"&&v==="?>"&&!g){N();h=true;}else if(a(t,"attribute-name")&&k.substr(-1).match(/^\s$/)){h=true;}else if(a(t,"attribute-equals")){M();L();}else if(a(t,"tag-close")){M();if(v==="/>")h=true;}else if(t.type==="keyword"&&v.match(/^(case|default)$/)){if(K)w=1;}if(g&&!(t.type.match(/^(comment)$/)&&!v.substr(0,1).match(/^[/#]$/))&&!(t.type.match(/^(string)$/)&&!v.substr(0,1).match(/^['"]$/))){u=q;if(o>p){u++;for(i=o;i>p;i--)I[i]=u;}else if(o<p)u=I[o];p=o;q=u;if(w)u-=w;if(E&&!x){u++;E=false;}for(i=0;i<u;i++)k+=c;}if(t.type==="keyword"&&v.match(/^(case|default)$/)){if(K===false){J[o]=v;o++;K=true;}}else if(t.type==="keyword"&&v.match(/^(break)$/)){if(J[o-1]&&J[o-1].match(/^(case|default)$/)){o--;K=false;}}if(t.type==="paren.lparen"){x+=(v.match(/\(/g)||[]).length;y+=(v.match(/\{/g)||[]).length;o+=v.length;}if(t.type==="keyword"&&v.match(/^(if|else|elseif|for|while)$/)){E=true;x=0;}else if(!x&&v.trim()&&t.type!=="comment")E=false;if(t.type==="paren.rparen"){x-=(v.match(/\)/g)||[]).length;y-=(v.match(/\}/g)||[]).length;for(i=0;i<v.length;i++){o--;if(v.substr(i,1)==='}'&&J[o]==='case'){o--;}}}if(t.type=="text")v=v.replace(/\s+$/," ");if(h&&!g){M();if(k.substr(-1)!=="\n")k+=" ";}k+=v;if(j)k+=" ";g=false;h=false;j=false;if((a(t,"tag-close")&&(H||f.indexOf(l)!==-1))||(a(t,"doctype")&&v===">")){if(H&&n&&n.value==="</")B=-1;else B=1;}if(a(t,"tag-open")&&v==="</"){o--;}else if(a(t,"tag-open")&&v==="<"&&d.indexOf(n.value)===-1){o++;}else if(a(t,"tag-name")){l=v;}else if(a(t,"tag-close")&&v==="/>"&&d.indexOf(l)===-1){o--;}z=A;}}t=n;}k=k.trim();s.doc.setValue(k);};e.commands=[{name:"beautify",description:"Format selection (Beautify)",exec:function(b){e.beautify(b.session);},bindKey:"Ctrl-Shift-B"}];});(function(){ace.require(["ace/ext/beautify"],function(m){if(typeof module=="object"&&typeof exports=="object"&&module){module.exports=m;}});})();
